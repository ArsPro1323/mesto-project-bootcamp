(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{_u:()=>j,lc:()=>$,vV:()=>E,oB:()=>J,Ml:()=>S});var t=function(e,t,r){n(t)?(r.classList.add(e.inactiveButtonClass),r.setAttribute("disabled","")):(r.classList.remove(e.inactiveButtonClass),r.removeAttribute("disabled"))},n=function(e){return e.some((function(e){return!e.validity.valid}))};function r(e){e.classList.add("popup_opened")}function o(e){e.classList.remove("popup_opened")}function c(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}document.querySelector(".popup-edit__form");var u={baseUrl:"https://nomoreparties.co/v1/exp-mipt-fbc-1",headers:{authorization:"ef6c3b3d-d5f0-409c-a46a-757be69258e6","Content-Type":"application/json"}},i=function(e){return fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/"+e,{method:"DELETE",headers:u.headers}).then(c)},a=function(e){return fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/likes/"+e,{method:"PUT",headers:u.headers}).then(c)},d=function(e){return fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/likes/"+e,{method:"DELETE",headers:u.headers}).then(c)},l=document.querySelector("#card").content,s=document.querySelector(".popup-card__image"),p=document.querySelector(".popup-card__description");function m(e,t,n,r,o){var c=l.querySelector(".card").cloneNode(!0);c.id=o;var u=c.querySelector(".card__image");u.src=e,u.alt=t,u.addEventListener("click",_),c.querySelector(".card__like-number").textContent=n.length,c.querySelector(".card__name").textContent=t;for(var i=c.querySelector(".card__like-button"),a=0;a<n.length;++a)n[a]._id==S&&i.classList.add("card__like-button_on");i.addEventListener("click",f);var d=c.querySelector(".card__delete-button");return d.addEventListener("click",y),r!==S&&d.classList.add("card__delete-button-inactive"),c}function f(e){e.preventDefault();var t=e.currentTarget,n=t.closest(".card"),r=e.currentTarget.closest(".card__like-section").querySelector(".card__like-number");String(e.currentTarget.classList).includes("card__like-button_on")?d(n.id).then((function(e){t.classList.toggle("card__like-button_on"),r.textContent=e.likes.length})).catch((function(e){console.log(e)})):a(n.id).then((function(e){t.classList.toggle("card__like-button_on"),r.textContent=e.likes.length})).catch((function(e){console.log(e)}))}function _(e){e.preventDefault();var t=e.currentTarget.closest(".card"),n=t.querySelector(".card__description").textContent;s.src=t.querySelector(".card__image").src,s.alt=n,p.textContent=n,r(E),document.addEventListener("keydown",$)}function v(){for(var e=0;e<J.length;e++)j.append(m(J[e].link,J[e].name,J[e].likes,J[e].owner,J[e].id))}function y(e){var t=e.currentTarget.closest(".card");i(t.id).then((function(e){t.remove()})).catch((function(e){console.log(e)}))}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var S,b=document.querySelector(".popup-edit"),g=document.querySelector(".popup-add-card"),k=document.querySelector(".popup-edit-logo"),q=document.querySelector(".popup-edit__save-button"),L=document.querySelector(".popup-add-card__save-button"),E=document.querySelector(".popup-card"),C=(k.querySelector(".popup-edit-logo__input"),document.querySelector(".popup-add-card__input_edit_name")),x=document.querySelector(".popup-add-card__input_edit_description"),w=document.querySelector(".popup-edit__input_edit_name"),A=document.querySelector(".popup-edit__input_edit_description"),T=document.querySelector(".profile__description"),O=document.querySelector(".profile__name"),j=document.querySelector(".elements"),P=document.querySelector(".popup-edit__input_edit_name"),U=document.querySelector(".popup-edit__input_edit_description"),B=document.querySelector(".popup-edit-logo__input"),D=document.querySelector(".profile__image"),I=document.querySelector(".popup-edit-logo__form"),N=document.querySelector(".popup-edit-logo__save-button"),J=[],M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};Promise.all([fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then(c),fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then(c)]).then((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,u,i=[],a=!0,d=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);a=!0);}catch(e){d=!0,o=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(d)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],r=t[1];O.textContent=n.name,T.textContent=n.about,D.style.backgroundImage="url("+n.avatar+")",S=n._id;for(var o=0;o<r.length;o++)J.push({name:r[o].name,link:r[o].link,likes:r[o].likes,owner:r[o].owner._id,id:r[o]._id});v()})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(n){!function(e,n){var r=Array.from(n.querySelectorAll(e.inputSelector)),o=n.querySelector(e.submitButtonSelector);t(e,r,o),r.forEach((function(c){c.addEventListener("input",(function(){t(e,r,o),function(e,t,n){n.validity.valid?function(e,t,n){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),r.classList.remove(e.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),o.textContent=r,o.classList.add(e.errorClass)}(e,t,n,n.validationMessage)}(e,n,c)}))}))}(e,n)}))}(M),document.querySelector(".popup-add-card__close-button").addEventListener("click",(function(){o(g),document.removeEventListener("keydown",$)}));var H=Array.from(document.querySelector(".popup-add-card__form").querySelectorAll(M.inputSelector)),z=document.querySelector(".popup-add-card__form").querySelector(M.submitButtonSelector),V=Array.from(I.querySelectorAll(M.inputSelector));function $(e){"Escape"===e.key&&(o(document.querySelector(".popup_opened")),document.removeEventListener("keydown",$))}document.querySelector(".profile__add-button").addEventListener("click",(function(){C.value="",x.value="",t(M,H,z),r(g),document.addEventListener("keydown",$)})),document.querySelector(".popup-add-card__form").addEventListener("submit",(function(e){var t,n;e.preventDefault(),L.textContent="Сохранение...",(t=C.value,n=x.value,fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:t,link:n})}).then(c)).then((function(e){j.prepend(m(e.link,e.name,[],S,e._id)),o(g),document.removeEventListener("keydown",$)})).finally((function(){L.textContent="Сохранить"})).catch((function(e){console.log(e)}))})),document.querySelector(".popup-card__close-button").addEventListener("click",(function(){o(E),document.removeEventListener("keydown",$)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){w.value=O.textContent,A.value=T.textContent,r(b),document.addEventListener("keydown",$)})),document.querySelector(".popup-edit__close-button").addEventListener("click",(function(){o(b),document.removeEventListener("keydown",$)})),document.querySelector(".popup-edit__form").addEventListener("submit",(function(e){var t,n;e.preventDefault(),q.textContent="Сохранение...",(t=P.value,n=U.value,fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:t,about:n})}).then(c)).then((function(e){O.textContent=e.name,T.textContent=e.about,o(b),document.removeEventListener("keydown",$)})).finally((function(){q.textContent="Сохранить"})).catch((function(e){console.log(e)}))})),I.addEventListener("submit",(function(e){var t;e.preventDefault(),N.textContent="Сохранение...",(t=B.value,fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:t})}).then(c)).then((function(e){D.style.backgroundImage="url("+e.avatar+")",o(k),document.removeEventListener("keydown",$)})).finally((function(){N.textContent.textContent="Сохранить"})).catch((function(e){console.log(e)}))})),g.addEventListener("click",(function(e){e.currentTarget===e.target&&(o(g),document.removeEventListener("keydown",$))})),b.addEventListener("click",(function(e){e.currentTarget===e.target&&(o(b),document.removeEventListener("keydown",$))})),E.addEventListener("click",(function(e){e.currentTarget===e.target&&(o(E),document.removeEventListener("keydown",$))})),document.querySelector(".profile__change-logo-button").addEventListener("click",(function(){B.value="",t(M,V,N),r(k),document.addEventListener("keydown",$)})),document.querySelector(".popup-edit-logo__close-button").addEventListener("click",(function(){o(k),document.removeEventListener("keydown",$)})),k.addEventListener("click",(function(e){e.currentTarget===e.target&&(o(k),document.removeEventListener("keydown",$))}))})();